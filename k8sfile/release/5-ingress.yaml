apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: frepai-srs-ingress
  namespace: frepai
  annotations:
    kubernetes.io/ingress.class: "nginx"
    nginx.ingress.kubernetes.io/rewrite-target: http://$1:1985/$2
    # nginx.ingress.kubernetes.io/server-snippet: |
    #   location ~ ^/(console|players)/ {
    #      proxy_pass http://127.0.0.1:8080/$request_uri;
    #   }
    #   location ~ ^/.+/.*\.(flv|m3u8|ts|aac|mp3)$ {
    #      proxy_pass http://127.0.0.1:8080$request_uri;
    #   }
    #   location ~ ^/(api|rtc)/ {
    #      proxy_pass http://127.0.0.1:1985$request_uri;
    #   }
spec:
  tls:
  - hosts:
    - srs.hzcsdata.com
    secretName: srs-hzcsdata-tls
  rules:
  - host: "srs.hzcsdata.com"
    http:
      paths:
        - pathType: Prefix
          # path: /(api|rtc|console|players)
          path: "/srs(/|$)(.*)"
          backend:
            service:
              name: srs-service
              port:
                number: 80
